---
---

<button 
	id="theme-toggle" 
	class="theme-toggle" 
	aria-label="Toggle dark mode"
	type="button"
>
	<span class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true">
		<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<circle cx="12" cy="12" r="5"></circle>
			<line x1="12" y1="1" x2="12" y2="3"></line>
			<line x1="12" y1="21" x2="12" y2="23"></line>
			<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
			<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
			<line x1="1" y1="12" x2="3" y2="12"></line>
			<line x1="21" y1="12" x2="23" y2="12"></line>
			<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
			<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
		</svg>
	</span>
	<span class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true">
		<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
		</svg>
	</span>
</button>

<style>
	.theme-toggle {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 40px;
		height: 40px;
		padding: 0;
		background: transparent;
		border: 1px solid var(--border-subtle);
		border-radius: var(--radius-md);
		cursor: pointer;
		color: var(--text-secondary);
		transition: all var(--transition-fast);
	}

	.theme-toggle:hover {
		border-color: var(--border-default);
		color: var(--text-primary);
		background-color: var(--bg-secondary);
	}

	.theme-toggle:focus-visible {
		outline: 2px solid var(--accent);
		outline-offset: 2px;
	}

	.theme-toggle__icon {
		display: none;
		transition: transform var(--transition-base);
	}

	/* Show sun icon in light mode */
	[data-theme="light"] .theme-toggle__icon--sun,
	:root:not([data-theme]) .theme-toggle__icon--sun {
		display: block;
	}

	/* Show moon icon in dark mode */
	[data-theme="dark"] .theme-toggle__icon--moon {
		display: block;
	}

	/* Animation on toggle */
	.theme-toggle__icon {
		animation: fadeIn var(--transition-base);
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: scale(0.8) rotate(-20deg);
		}
		to {
			opacity: 1;
			transform: scale(1) rotate(0);
		}
	}
</style>

<script is:inline>
	(function() {
		// Function to get the current theme
		function getTheme() {
			// Check for stored preference
			const stored = localStorage.getItem('theme');
			if (stored) return stored;
			
			// Check system preference
			if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
				return 'dark';
			}
			
			// Default to light
			return 'light';
		}

		// Function to set the theme
		function setTheme(theme) {
			document.documentElement.setAttribute('data-theme', theme);
			localStorage.setItem('theme', theme);
		}

		// Apply theme immediately to prevent flash
		const theme = getTheme();
		setTheme(theme);

		// Set up toggle functionality when DOM is ready
		document.addEventListener('DOMContentLoaded', function() {
			const toggle = document.getElementById('theme-toggle');
			
			if (toggle) {
				toggle.addEventListener('click', function() {
					const currentTheme = document.documentElement.getAttribute('data-theme');
					const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
					setTheme(newTheme);
				});

				// Handle keyboard navigation
				toggle.addEventListener('keydown', function(e) {
					if (e.key === 'Enter' || e.key === ' ') {
						e.preventDefault();
						toggle.click();
					}
				});
			}
		});

		// Listen for system preference changes
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
			// Only update if user hasn't manually set a preference
			if (!localStorage.getItem('theme')) {
				setTheme(e.matches ? 'dark' : 'light');
			}
		});
	})();
</script>
